/**
 * @return {undefined}
 */
function initSplash() {
  /** @type {string} */
  gameState = "splash";
  if (allowSound) {
    if (!muted) {
      music.play();
    }
  }
  initStartScreen();
}
/**
 * @return {undefined}
 */
function initStartScreen() {
  /** @type {string} */
  document.getElementById("moregame").style.display = "none";
  /** @type {string} */
  gameState = "start";
  /** @type {number} */
  gameScore = 0;
  userInput.addHitArea("mute", butEventHandler, null, {
    type: "rect",
    aRect: [336, 0, canvas.width, 48]
  }, true);
  background = new Elements.Background(assetLib.getData("background"), canvas.width, canvas.height);
  var cols = {
    oImgData: assetLib.getData("playBut"),
    aPos: [canvas.width / 2, 370]
  };
  var y = {
    oImgData: assetLib.getData("moreGamesBut"),
    aPos: [canvas.width / 2, 480]
  };
  userInput.addHitArea("startGame", butEventHandler, null, {
    type: "image",
    oImageData: cols.oImgData,
    aCentrePos: cols.aPos
  });
  userInput.addHitArea("moreGames", butEventHandler, null, {
    type: "image",
    oImageData: y.oImgData,
    aCentrePos: y.aPos
  });
  /** @type {Array} */
  var row = new Array(cols, y);
  panel = new Elements.Panel(assetLib.getData("panels"), assetLib.getData("thinNumbers"), assetLib.getData("fatNumbers"), gameState, row, canvas.width, canvas.height);
  panel.startTween();
  /** @type {Array} */
  aDots = new Array;
  /** @type {number} */
  var d = 0;
  for (; 6 > d; d++) {
    var face = new Elements.Dot(assetLib.getData("dot"), assetLib.getData("pop"), d, d, canvas.width, canvas.height);
    /** @type {number} */
    face.x = Math.random() * canvas.width;
    /** @type {number} */
    face.y = Math.random() * canvas.height;
    aDots.push(face);
  }
  /** @type {number} */
  previousTime = (new Date).getTime();
  updateStartScreenEvent();
}
/**
 * @return {?}
 */
function initPreGame() {
  /** @type {string} */
  gameState = "tutorial";
  /** @type {number} */
  var i = 0;
  for (; i < aTutorials.length; i++) {
    if (aTutorials[i].gameNum == gameNum && !aTutorials[i].shown) {
      background = new Elements.Background(assetLib.getData("background"), canvas.width, canvas.height);
      userInput.addHitArea("continue", butEventHandler, null, {
        type: "rect",
        aRect: [100, 265, 220, 345]
      });
      var cols = {
        oImgData: assetLib.getData("playBut"),
        aPos: [canvas.width / 2, 465]
      };
      userInput.addHitArea("continue", butEventHandler, null, {
        type: "image",
        oImageData: cols.oImgData,
        aCentrePos: cols.aPos
      });
      /** @type {Array} */
      var row = new Array(cols);
      return panel = new Elements.Panel(assetLib.getData("panels"), assetLib.getData("thinNumbers"), assetLib.getData("fatNumbers"), aTutorials[i].panelType, row, canvas.width, canvas.height), panel.startTween(), previousTime = (new Date).getTime(), updateTutorialEvent(), void 0;
    }
  }
  initGame();
}
/**
 * @return {undefined}
 */
function initGame() {
  /** @type {string} */
  gameState = "game";
  if (allowSound) {
    music.volume(0.5);
  }
  background = new Elements.Background(assetLib.getData("background"), canvas.width, canvas.height);
  userInput.addHitArea("pause", butEventHandler, null, {
    type: "rect",
    aRect: [294, 0, 336, 48]
  }, true);
  hud = new Elements.Hud(assetLib.getData("hud"), assetLib.getData("thinNumbers"), assetLib.getData("fatNumbers"), canvas.width, canvas.height);
  /** @type {Array} */
  aDots = new Array;
  /** @type {Array} */
  aSelected = new Array;
  /** @type {number} */
  gameTime = 60;
  /** @type {number} */
  gameScore = 0;
  /** @type {boolean} */
  blockTap = false;
  /** @type {number} */
  longestChain = 0;
  /** @type {number} */
  balloonsPopped = 0;
  /** @type {null} */
  lastSelectedDot = null;
  /** @type {number} */
  var arg = 0;
  for (; 42 > arg; arg++) {
    var seg = new Elements.Dot(assetLib.getData("dot"), assetLib.getData("pop"), arg, getNewDotType(), canvas.width, canvas.height);
    /** @type {number} */
    seg.targX = Math.round(62 * (arg % 6) + 36);
    /** @type {number} */
    seg.targY = Math.round(getYPosFromId(arg));
    seg.fall();
    userInput.addHitArea("dotHit", butEventHandler, {
      id: arg,
      isDraggable: true
    }, {
      type: "rect",
      aRect: [seg.x - 22, seg.targY - 22, seg.x + 22, seg.targY + 22]
    });
    aDots.push(seg);
  }
  background.startScroll(20);
  userInput.addHitArea("mouseUp", butEventHandler, {
    multiTouch: true
  }, {
    type: "rect",
    aRect: [0, 0, canvas.width, canvas.height]
  });
  /** @type {number} */
  previousTime = (new Date).getTime();
  updateGameEvent();
}
/**
 * @param {?} dataAndEvents
 * @param {Object} details
 * @return {undefined}
 */
function butEventHandler(dataAndEvents, details) {
  switch (dataAndEvents) {
    case "langSelect":
      console.log(details.lang);
      curLang = details.lang;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      userInput.removeHitArea("langSelect");
      initLoadAssets();
      break;
    case "startGame":
      playSound("click");
      userInput.removeHitArea("startGame");
      userInput.removeHitArea("moreGames");
      initPreGame();
      break;
    case "moreGames":
      clickMore();
      break;
    case "dotHit":
      if (blockTap) {
        break;
      }
      if (details.isBeingDragged) {
        if (null == lastSelectedDot) {
          break;
        }
        lastSelectedDot = aDots[details.id].trySelect(lastSelectedDot);
        /** @type {number} */
        var x = -1;
        /** @type {number} */
        var len = 0;
        for (; len < aSelected.length; len++) {
          if (aSelected[len] == lastSelectedDot) {
            /** @type {number} */
            x = len;
          }
        }
        if (-1 == x) {
          aSelected.push(lastSelectedDot);
          playSound("drag");
        } else {
          /** @type {number} */
          len = x + 1;
          for (; len < aSelected.length; len++) {
            aSelected[len].unSelect();
            aSelected.splice(len, 1);
            len -= 1;
          }
        }
      } else {
        if (aDots[details.id].type < 6) {
          aDots[details.id].select();
          lastSelectedDot = aDots[details.id];
          /** @type {Array} */
          aSelected = new Array(lastSelectedDot);
          playSound("drag");
        }
      }
      break;
    case "mouseUp":
      if (!details.isDown) {
        if (blockTap) {
          break;
        }
        if (aSelected.length >= 3) {
          /** @type {number} */
          var e = 0;
          var n = aSelected.length;
          /** @type {boolean} */
          var g = false;
          /** @type {number} */
          len = 0;
          for (; n > len; len++) {
            if (7 == aSelected[len].type || 9 == aSelected[len].type) {
              /** @type {boolean} */
              g = true;
              /** @type {number} */
              var h = 0;
              for (; 6 > h; h++) {
                /** @type {boolean} */
                var i = true;
                /** @type {number} */
                var conditionIndex = 0;
                for (; conditionIndex < aSelected.length; conditionIndex++) {
                  if (aSelected[conditionIndex] == aDots[6 * Math.floor(aSelected[len].id / 6) + h]) {
                    /** @type {boolean} */
                    i = false;
                  }
                }
                if (i) {
                  aSelected.push(aDots[6 * Math.floor(aSelected[len].id / 6) + h]);
                }
              }
            }
            if (8 == aSelected[len].type || 9 == aSelected[len].type) {
              /** @type {boolean} */
              g = true;
              /** @type {number} */
              h = 0;
              for (; 7 > h; h++) {
                /** @type {boolean} */
                i = true;
                /** @type {number} */
                conditionIndex = 0;
                for (; conditionIndex < aSelected.length; conditionIndex++) {
                  if (aSelected[conditionIndex] == aDots[aSelected[len].id % 6 + 6 * h]) {
                    /** @type {boolean} */
                    i = false;
                  }
                }
                if (i) {
                  aSelected.push(aDots[aSelected[len].id % 6 + 6 * h]);
                }
              }
            }
          }
          sortThis(aSelected);
          /** @type {number} */
          len = 0;
          for (; len < aSelected.length; len++) {
            if (10 == aSelected[len].type) {
              e++;
            } else {
              if (11 == aSelected[len].type) {
                gameTime += 5;
              }
            }
            aSelected[len].hit(len / aSelected.length);
          }
          /** @type {number} */
          longestChain = Math.max(aSelected.length, longestChain);
          balloonsPopped += aSelected.length;
          if (g) {
            playSound("explode");
          } else {
            if (3 == aSelected.length) {
              playSound("pop1");
            } else {
              if (aSelected.length < 7) {
                playSound("pop2");
              } else {
                playSound("pop3");
              }
            }
          }
          updateScore(10 * n * n + 100 * aSelected.length + 2 * e * 100 * aSelected.length);
          /** @type {boolean} */
          blockTap = true;
          background.startScroll(aSelected.length);
        } else {
          /** @type {number} */
          len = 0;
          for (; len < aSelected.length; len++) {
            aSelected[len].unSelect();
          }
          /** @type {Array} */
          aSelected = new Array;
        }
        /** @type {number} */
        removedDots = 0;
        /** @type {null} */
        lastSelectedDot = null;
      }
      break;
    case "continue":
      playSound("click");
      userInput.removeHitArea("continue");
      initGame();
      break;
    case "newGame":
      playSound("click");
      userInput.removeHitArea("pause");
      userInput.removeHitArea("newGame");
      userInput.removeHitArea("quitFromEnd");
      gameNum++;
      initPreGame();
      break;
    case "quitFromEnd":
      playSound("click");
      userInput.removeHitArea("pause");
      userInput.removeHitArea("newGame");
      userInput.removeHitArea("quitFromEnd");
      initStartScreen();
      break;
    case "mute":
      playSound("click");
      toggleMute();
      break;
    case "pause":
      ;
    case "resumeFromPause":
      playSound("click");
      toggleManualPause();
      break;
    case "quitFromPause":
      playSound("click");
      toggleManualPause();
      userInput.removeHitArea("pause");
      userInput.removeHitArea("dotHit");
      userInput.removeHitArea("mouseUp");
      userInput.removeHitArea("quitFromPause");
      userInput.removeHitArea("resumeFromPause");
      /** @type {number} */
      gameScore = 0;
      initStartScreen();
  }
}
/**
 * @param {Array} str
 * @return {undefined}
 */
function sortThis(str) {
  str.sort(function (depMap, elem) {
    var depId = depMap.id;
    var parent = elem.id;
    return parent > depId ? -1 : depId > parent ? 1 : 0;
  });
}
/**
 * @param {number} forceUpdate
 * @return {undefined}
 */
function updateScore(forceUpdate) {
  gameScore += forceUpdate;
  hud.updateScore(gameScore);
}
/**
 * @return {undefined}
 */
function initGameOver() {
  /** @type {string} */
  gameState = "gameOver";
  if (allowSound) {
    music.volume(0.25);
  }
  userInput.removeHitArea("dotHit");
  userInput.removeHitArea("mouseUp");
  playSound("timesUp");
  background = new Elements.Background(assetLib.getData("background"), canvas.width, canvas.height);
  var cols = {
    oImgData: assetLib.getData("playBut"),
    aPos: [263, 465]
  };
  var y = {
    oImgData: assetLib.getData("quitBut"),
    aPos: [120, 465]
  };
  userInput.addHitArea("newGame", butEventHandler, null, {
    type: "image",
    oImageData: cols.oImgData,
    aCentrePos: cols.aPos
  });
  userInput.addHitArea("quitFromEnd", butEventHandler, null, {
    type: "image",
    oImageData: y.oImgData,
    aCentrePos: y.aPos
  });
  /** @type {Array} */
  var row = new Array(cols, y);
  panel = new Elements.Panel(assetLib.getData("panels"), assetLib.getData("thinNumbers"), assetLib.getData("fatNumbers"), gameState, row, canvas.width, canvas.height);
  panel.startTween();
  /** @type {number} */
  highScore = Math.max(gameScore, highScore);
  try {
    window.kaisergames.submitHighscore(0, gameScore);
  } catch (d) {}
  panel.oScoreData = {
    gameScore: gameScore,
    longestChain: longestChain,
    balloonsPopped: balloonsPopped,
    highScore: highScore
  };
  /** @type {number} */
  previousTime = (new Date).getTime();
  updateGameOver();
  dp_submitScore(gameScore);
  /** @type {string} */
  document.getElementById("moregame").style.display = "block";
}
/**
 * @return {undefined}
 */
function replaceDots() {
  /** @type {number} */
  var i = 0;
  for (; i < aSelected.length; i++) {
    /** @type {number} */
    var id = 6;
    for (; aSelected[i].id + id < 42 && !aDots[aSelected[i].id + id].canHit;) {
      id += 6;
    }
    if (aSelected[i].id > 36 || aSelected[i].id + id >= 42) {
      aDots[aSelected[i].id].replaceWithNewDot(getNewDotType());
    } else {
      aDots[aSelected[i].id].replaceWithExistingDot(aDots[aSelected[i].id + id]);
      renderSprite(aDots[aSelected[i].id]);
      if (aDots[aSelected[i].id + id].canHit) {
        /** @type {boolean} */
        aDots[aSelected[i].id + id].canHit = false;
        aSelected.push(aDots[aSelected[i].id + id]);
        sortThis(aSelected);
      }
    }
  }
  /** @type {Array} */
  aSelected = new Array;
  /** @type {boolean} */
  blockTap = false;
}
/**
 * @param {number} t
 * @return {?}
 */
function getYPosFromId(t) {
  return 62 * Math.floor(t / 6) + 110;
}
/**
 * @return {?}
 */
function getNewDotType() {
  return 9 * Math.random() < 8 ? Math.floor(6 * Math.random()) : Math.floor(6 * Math.random() + 6);
}
/**
 * @return {?}
 */
function updateGameEvent() {
  if (!manualPause && (!rotatePause && "game" == gameState)) {
    var delta = getDelta();
    background.render(ctx);
    /** @type {number} */
    var xx = 0;
    for (; xx < aDots.length; xx++) {
      aDots[xx].update(delta);
      renderSprite(aDots[xx]);
      if (aDots[xx].removeMe) {
        /** @type {boolean} */
        aDots[xx].removeMe = false;
        if (++removedDots == aSelected.length) {
          replaceDots();
        }
      }
    }
    if (gameTime -= delta, 0 >= gameTime) {
      return initGameOver(), void 0;
    }
    hud.render(ctx, Math.round(gameTime));
    renderMuteBut();
    requestAnimFrame(updateGameEvent);
  }
}
/**
 * @return {undefined}
 */
function updateGameOver() {
  if (!rotatePause && "gameOver" == gameState) {
    var delta = getDelta();
    background.updateScroll(delta);
    background.render(ctx);
    panel.update(delta);
    panel.render(ctx);
    renderMuteBut();
    requestAnimFrame(updateGameOver);
  }
}
/**
 * @return {?}
 */
function updateSplashScreenEvent() {
  if (!rotatePause && "splash" == gameState) {
    var delta = getDelta();
    if (splashTimer += delta, splashTimer > 2.5) {
      return allowSound && (!muted && music.play()), initStartScreen(), void 0;
    }
    splash.render(ctx, delta);
    requestAnimFrame(updateSplashScreenEvent);
  }
}
/**
 * @return {undefined}
 */
function updateStartScreenEvent() {
  if (!rotatePause && "start" == gameState) {
    var delta = getDelta();
    background.updateScroll(delta);
    background.render(ctx);
    /** @type {number} */
    var n = 0;
    for (; n < aDots.length; n++) {
      aDots[n].y -= (30 + 2 * n) * delta;
      /** @type {number} */
      aDots[n].x = aDots[n].x - 50 * Math.sin(aDots[n].y / 50) * delta;
      if (aDots[n].y < -100) {
        /** @type {number} */
        aDots[n].x = Math.random() * canvas.width;
        aDots[n].y = canvas.height + 200 * Math.random() + 100;
      }
      aDots[n].update(delta);
      renderSprite(aDots[n]);
    }
    panel.update(delta);
    panel.render(ctx);
    renderMuteBut();
    requestAnimFrame(updateStartScreenEvent);
  }
}
/**
 * @return {undefined}
 */
function updateTutorialEvent() {
  if (!rotatePause && "tutorial" == gameState) {
    var delta = getDelta();
    background.updateScroll(delta);
    background.render(ctx);
    panel.update(delta);
    panel.render(ctx);
    renderMuteBut();
    requestAnimFrame(updateTutorialEvent);
  }
}
/**
 * @return {?}
 */
function getDelta() {
  /** @type {number} */
  var time = (new Date).getTime();
  /** @type {number} */
  var s = (time - previousTime) / 1E3;
  return previousTime = time, s > 0.5 && (s = 0), s;
}
/**
 * @param {Object} t
 * @return {undefined}
 */
function renderSprite(t) {
  ctx.save();
  ctx.translate(t.x, t.y);
  ctx.scale(t.scaleX, t.scaleY);
  ctx.rotate(t.rotation);
  t.render(ctx);
  ctx.restore();
}
/**
 * @param {Object} point
 * @param {?} p1
 * @param {?} tickOffset
 * @return {?}
 */
function checkSpriteCollision(point, p1, tickOffset) {
  var cx = point.x;
  var cy = point.y;
  var px = p1.x;
  var py = p1.y;
  /** @type {number} */
  var b = (cx - px) * (cx - px) + (cy - py) * (cy - py);
  /** @type {number} */
  var a = (point.radius + tickOffset) * (point.radius + tickOffset);
  return a > b ? true : false;
}
/**
 * @return {undefined}
 */
function loadPreAssets() {
  if (aLangs.length > 1) {
    preAssetLib = new Utils.AssetLoader(curLang, [{
      id: "langSelect",
      file: "images/langSelect.jpg"
    }, {
      id: "preloadImage",
      file: "images/preloadImage.jpg"
    }], ctx, canvas.width, canvas.height, false);
    preAssetLib.onReady(initLangSelect);
  } else {
    curLang = aLangs[0];
    preAssetLib = new Utils.AssetLoader(curLang, [{
      id: "preloadImage",
      file: "images/preloadImage.jpg"
    }], ctx, canvas.width, canvas.height, false);
    preAssetLib.onReady(initLoadAssets);
  }
}
/**
 * @return {undefined}
 */
function initLangSelect() {
  var img = preAssetLib.getData("langSelect");
  ctx.drawImage(img.img, 0, 0, img.img.width, img.img.height, canvas.width / 2 - 0.75 * (img.img.width / 2), canvas.height / 2 - 0.75 * (img.img.height / 2), 0.75 * img.img.width, 0.75 * img.img.height);
  /** @type {number} */
  var blockSize = 105;
  /** @type {number} */
  var i = 0;
  for (; i < aLangs.length; i++) {
    /** @type {number} */
    var length = canvas.width / 2 - blockSize * aLangs.length / 2 + i * blockSize;
    /** @type {number} */
    var aRect = canvas.height / 2 - blockSize / 2;
    userInput.addHitArea("langSelect", butEventHandler, {
      lang: aLangs[i]
    }, {
      type: "rect",
      aRect: [length, aRect, length + blockSize, aRect + 140]
    });
  }
}
/**
 * @return {undefined}
 */
function initLoadAssets() {
  var img = preAssetLib.getData("preloadImage");
  ctx.drawImage(img.img, 0, 0);
  loadAssets();
}
/**
 * @return {undefined}
 */
function loadAssets() {
  assetLib = new Utils.AssetLoader(curLang, [{
    id: "background",
    file: "images/background.jpg"
  }, {
    id: "rotateDeviceMessage",
    file: "images/rotateDeviceMessage.jpg"
  }, {
    id: "splash",
    file: "images/splashScreen.jpg"
  }, {
    id: "hud",
    file: "images/" + curLang + "/hud.png"
  }, {
    id: "playBut",
    file: "images/playBut.png"
  }, {
    id: "quitBut",
    file: "images/quitBut.png"
  }, {
    id: "moreGamesBut",
    file: "images/" + curLang + "/moreGamesBut.png"
  }, {
    id: "panels",
    file: "images/" + curLang + "/panels_383x550.png",
    oData: {
      columns: 2,
      spriteWidth: 383,
      spriteHeight: 550
    }
  }, {
    id: "dot",
    file: "images/dots_64x86.png",
    oData: {
      oAnims: {
        unSelected0: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19],
        unSelected1: [20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39],
        unSelected2: [40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59],
        unSelected3: [60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79],
        unSelected4: [80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99],
        unSelected5: [100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119],
        unSelected6: [120],
        unSelected7: [121],
        unSelected8: [122],
        unSelected9: [123],
        unSelected10: [124],
        unSelected11: [125],
        selected0: [126, 127, 128, 129],
        selected1: [130, 131, 132, 133],
        selected2: [134, 135, 136, 137],
        selected3: [138, 139, 140, 141],
        selected4: [142, 143, 144, 145],
        selected5: [146, 147, 148, 149],
        selected6: [150, 151, 152, 153],
        selected7: [154, 155, 156, 157],
        selected8: [158, 159, 160, 161],
        selected9: [162, 163, 164, 165],
        selected10: [166, 167, 168, 169],
        selected11: [170, 171, 172, 173]
      },
      columns: 16,
      spriteWidth: 64,
      spriteHeight: 86
    }
  }, {
    id: "pop",
    file: "images/pop_156x141.png",
    oData: {
      oAnims: {
        pop: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
      },
      columns: 6,
      spriteWidth: 156,
      spriteHeight: 141
    }
  }, {
    id: "fatNumbers",
    file: "images/fatNumbers_33x41.png",
    oData: {
      columns: 10,
      spriteWidth: 33,
      spriteHeight: 41
    }
  }, {
    id: "thinNumbers",
    file: "images/thinNumbers_25x32.png",
    oData: {
      columns: 10,
      spriteWidth: 25,
      spriteHeight: 32
    }
  }, {
    id: "muteBut",
    file: "images/mute_35x35.png",
    oData: {
      columns: 2,
      spriteWidth: 35,
      spriteHeight: 35
    }
  }], ctx, canvas.width, canvas.height, false);
  assetLib.onReady(initSplash);
}
/**
 * @return {undefined}
 */
function resizeCanvas() {
  /** @type {number} */
  var width = window.innerWidth;
  /** @type {number} */
  var height = window.innerHeight;
  if (width > 480) {
    width -= 1;
    height -= 1;
  }
  if (window.innerWidth > window.innerHeight && isMobile) {
    if ("loading" != gameState) {
      rotatePauseOn();
    }
    if (width / canvas.width < height / canvas.height) {
      /** @type {string} */
      canvas.style.width = width + "px";
      /** @type {string} */
      canvas.style.height = width / canvas.width * canvas.height + "px";
      /** @type {number} */
      canvasX = 0;
      /** @type {number} */
      canvasY = (height - width / canvas.width * canvas.height) / 2;
      /** @type {number} */
      canvasScaleX = canvasScaleY = canvas.width / width;
      /** @type {string} */
      div.style.marginTop = canvasY + "px";
      /** @type {string} */
      div.style.marginLeft = canvasX + "px";
    } else {
      /** @type {string} */
      canvas.style.width = height / canvas.height * canvas.width + "px";
      /** @type {string} */
      canvas.style.height = height + "px";
      /** @type {number} */
      canvasX = (width - height / canvas.height * canvas.width) / 2;
      /** @type {number} */
      canvasY = 0;
      /** @type {number} */
      canvasScaleX = canvasScaleY = canvas.height / height;
      /** @type {string} */
      div.style.marginTop = canvasY + "px";
      /** @type {string} */
      div.style.marginLeft = canvasX + "px";
    }
  } else {
    if (isMobile) {
      if (rotatePause) {
        rotatePauseOff();
      }
      /** @type {number} */
      canvasX = canvasY = 0;
      /** @type {number} */
      canvasScaleX = canvas.width / width;
      /** @type {number} */
      canvasScaleY = canvas.height / height;
      /** @type {string} */
      canvas.style.width = width + "px";
      /** @type {string} */
      canvas.style.height = height + "px";
      /** @type {string} */
      div.style.marginTop = "0px";
      /** @type {string} */
      div.style.marginLeft = "0px";
    } else {
      if (rotatePause) {
        rotatePauseOff();
      }
      if (width / canvas.width < height / canvas.height) {
        /** @type {string} */
        canvas.style.width = width + "px";
        /** @type {string} */
        canvas.style.height = width / canvas.width * canvas.height + "px";
        /** @type {number} */
        canvasX = 0;
        /** @type {number} */
        canvasY = (height - width / canvas.width * canvas.height) / 2;
        /** @type {number} */
        canvasScaleX = canvasScaleY = canvas.width / width;
        /** @type {string} */
        div.style.marginTop = canvasY + "px";
        /** @type {string} */
        div.style.marginLeft = canvasX + "px";
      } else {
        /** @type {string} */
        canvas.style.width = height / canvas.height * canvas.width + "px";
        /** @type {string} */
        canvas.style.height = height + "px";
        /** @type {number} */
        canvasX = (width - height / canvas.height * canvas.width) / 2;
        /** @type {number} */
        canvasY = 0;
        /** @type {number} */
        canvasScaleX = canvasScaleY = canvas.height / height;
        /** @type {string} */
        div.style.marginTop = canvasY + "px";
        /** @type {string} */
        div.style.marginLeft = canvasX + "px";
      }
    }
  }
  userInput.setCanvas(canvasX, canvasY, canvasScaleX, canvasScaleY);
}
/**
 * @param {string} name
 * @return {undefined}
 */
function playSound(name) {
  if (allowSound) {
    sound.play(name);
  }
}
/**
 * @return {undefined}
 */
function toggleMute() {
  /** @type {boolean} */
  muted = !muted;
  if (allowSound) {
    if (muted) {
      Howler.mute();
    } else {
      Howler.unmute();
    }
  }
  renderMuteBut();
}
/**
 * @return {undefined}
 */
function renderMuteBut() {
  if (allowSound) {
    var img = assetLib.getData("muteBut");
    /** @type {number} */
    var sectionLength = 0;
    if (muted) {
      /** @type {number} */
      sectionLength = 1;
    }
    /** @type {number} */
    var startX = sectionLength * img.oData.spriteWidth % img.img.width;
    /** @type {number} */
    var offsetY = Math.floor(sectionLength / (img.img.width / img.oData.spriteWidth)) * img.oData.spriteHeight;
    ctx.drawImage(img.img, startX, offsetY, img.oData.spriteWidth, img.oData.spriteHeight, 340, 10, img.oData.spriteWidth, img.oData.spriteHeight);
  }
}
/**
 * @return {undefined}
 */
function toggleManualPause() {
  if (manualPause) {
    /** @type {boolean} */
    manualPause = false;
    userInput.removeHitArea("quitFromPause");
    userInput.removeHitArea("resumeFromPause");
    pauseCoreOff();
  } else {
    /** @type {boolean} */
    manualPause = true;
    pauseCoreOn();
    var cols = {
      oImgData: assetLib.getData("quitBut"),
      aPos: [120, 465]
    };
    var y = {
      oImgData: assetLib.getData("playBut"),
      aPos: [263, 465]
    };
    /** @type {Array} */
    var row = new Array(cols, y);
    userInput.addHitArea("quitFromPause", butEventHandler, null, {
      type: "image",
      oImageData: cols.oImgData,
      aCentrePos: cols.aPos
    });
    userInput.addHitArea("resumeFromPause", butEventHandler, null, {
      type: "image",
      oImageData: y.oImgData,
      aCentrePos: y.aPos
    });
    panel = new Elements.Panel(assetLib.getData("panels"), assetLib.getData("thinNumbers"), assetLib.getData("fatNumbers"), "pause", row, canvas.width, canvas.height);
    panel.render(ctx);
    userInput.addHitArea("pause", butEventHandler, null, {
      type: "rect",
      aRect: [294, 0, 336, 48]
    }, true);
  }
}
/**
 * @return {undefined}
 */
function rotatePauseOn() {
  /** @type {boolean} */
  rotatePause = true;
  ctx.drawImage(assetLib.getImg("rotateDeviceMessage"), 0, 0);
  /** @type {boolean} */
  userInput.pauseIsOn = true;
  pauseCoreOn();
}
/**
 * @return {undefined}
 */
function rotatePauseOff() {
  /** @type {boolean} */
  rotatePause = false;
  pauseCoreOff();
}
/**
 * @return {undefined}
 */
function pauseCoreOn() {
  switch (allowSound && Howler.mute(), gameState) {
    case "start":
      break;
    case "help":
      break;
    case "game":
      userInput.removeHitArea("dotHit");
      userInput.removeHitArea("mouseUp");
      break;
    case "end":
      ;
  }
}
/**
 * @return {undefined}
 */
function pauseCoreOff() {
  switch (allowSound && (muted || Howler.unmute()), previousTime = (new Date).getTime(), userInput.pauseIsOn = false, gameState) {
    case "splash":
      updateSplashScreenEvent();
      break;
    case "start":
      initStartScreen();
      break;
    case "tutorial":
      initPreGame();
      break;
    case "game":
      /** @type {boolean} */
      manualPause = false;
      /** @type {number} */
      var r = 0;
      for (; r < aDots.length; r++) {
        userInput.addHitArea("dotHit", butEventHandler, {
          id: r,
          isDraggable: true
        }, {
          type: "rect",
          aRect: [aDots[r].x - 22, aDots[r].targY - 22, aDots[r].x + 22, aDots[r].targY + 22]
        });
      }
      userInput.addHitArea("mouseUp", butEventHandler, {
        multiTouch: true
      }, {
        type: "rect",
        aRect: [0, 0, canvas.width, canvas.height]
      });
      updateGameEvent();
      break;
    case "gameOver":
      initGameOver();
  }
}
var Utils;
! function (eventHandle) {
  var elem = function () {
    /**
     * @param {?} e
     * @param {Array} codeSegments
     * @param {Object} dataAndEvents
     * @param {number} canvasWidth
     * @param {?} canvasHeight
     * @param {boolean} io
     * @return {undefined}
     */
    function canvas_onclick_func(e, codeSegments, dataAndEvents, canvasWidth, canvasHeight, io) {
      if ("undefined" == typeof io) {
        /** @type {boolean} */
        io = true;
      }
      this.oAssetData = {};
      /** @type {number} */
      this.assetsLoaded = 0;
      this.totalAssets = codeSegments.length;
      /** @type {Object} */
      this.ctx = dataAndEvents;
      /** @type {number} */
      this.canvasWidth = canvasWidth;
      this.canvasHeight = canvasHeight;
      /** @type {boolean} */
      this.showBar = io;
      /** @type {number} */
      this.topLeftX = this.canvasWidth / 2 - canvasWidth / 4;
      /** @type {number} */
      this.topLeftY = this.canvasHeight / 2;
      if (this.showBar) {
        /** @type {string} */
        ctx.strokeStyle = "#aaaaaa";
        /** @type {number} */
        ctx.lineWidth = 2;
        /** @type {string} */
        ctx.fillStyle = "#ffffff";
        ctx.moveTo(this.topLeftX, this.topLeftY);
        ctx.lineTo(this.topLeftX + canvasWidth / 2, this.topLeftY + 0);
        ctx.lineTo(this.topLeftX + canvasWidth / 2, this.topLeftY + 20);
        ctx.lineTo(this.topLeftX + 0, this.topLeftY + 20);
        ctx.lineTo(this.topLeftX + 0, this.topLeftY + 0);
        ctx.stroke();
      }
      /** @type {number} */
      var i = 0;
      for (; i < codeSegments.length; i++) {
        this.loadImage(codeSegments[i]);
      }
    }
    return canvas_onclick_func.prototype.loadImage = function (item) {
      var self = this;
      /** @type {Image} */
      var img = new Image;
      /**
       * @return {undefined}
       */
      img.onload = function () {
        self.oAssetData[item.id] = {};
        /** @type {Image} */
        self.oAssetData[item.id].img = img;
        if (void 0 != item.oData) {
          self.oAssetData[item.id].oData = item.oData;
        }
        ++self.assetsLoaded;
        if (self.showBar) {
          ctx.fillRect(self.topLeftX + 2, self.topLeftY + 2, (self.canvasWidth / 2 - 4) / self.totalAssets * self.assetsLoaded, 16);
        }
        self.checkLoadComplete();
      };
      img.src = item.file;
    }, canvas_onclick_func.prototype.checkLoadComplete = function () {
      if (this.assetsLoaded == this.totalAssets) {
        this.loadedCallback();
      }
    }, canvas_onclick_func.prototype.onReady = function (options) {
      /** @type {Function} */
      this.loadedCallback = options;
    }, canvas_onclick_func.prototype.getImg = function (key) {
      return this.oAssetData[key].img;
    }, canvas_onclick_func.prototype.getData = function (name) {
      return this.oAssetData[name];
    }, canvas_onclick_func;
  }();
  eventHandle.AssetLoader = elem;
}(Utils || (Utils = {}));
! function (eventHandle) {
  var elem = function () {
    /**
     * @param {?} far
     * @param {number} fps
     * @param {Blob} radius
     * @param {string} near
     * @return {undefined}
     */
    function Camera(far, fps, radius, near) {
      /** @type {number} */
      this.x = 0;
      /** @type {number} */
      this.y = 0;
      /** @type {number} */
      this.rotation = 0;
      /** @type {number} */
      this.radius = 10;
      /** @type {boolean} */
      this.removeMe = false;
      /** @type {number} */
      this.frameInc = 0;
      /** @type {string} */
      this.animType = "loop";
      /** @type {number} */
      this.offsetX = 0;
      /** @type {number} */
      this.offsetY = 0;
      /** @type {number} */
      this.scaleX = 1;
      /** @type {number} */
      this.scaleY = 1;
      this.oImgData = far;
      this.oAnims = this.oImgData.oData.oAnims;
      /** @type {number} */
      this.fps = fps;
      /** @type {Blob} */
      this.radius = radius;
      /** @type {string} */
      this.animId = near;
    }
    return Camera.prototype.changeSpriteSheet = function (dataAndEvents) {
      this.oImgData = dataAndEvents;
      this.oAnims = this.oImgData.oData.oAnims;
      this.resetAnim();
    }, Camera.prototype.updateAnimation = function (oldAnimation) {
      this.frameInc += this.fps * oldAnimation;
    }, Camera.prototype.resetAnim = function () {
      /** @type {number} */
      this.frameInc = 0;
    }, Camera.prototype.setFrame = function (b) {
      this.fixedFrame = b;
    }, Camera.prototype.setAnimType = function (callback, pop, recurring) {
      switch ("undefined" == typeof recurring && (recurring = true), this.animId = pop, this.animType = callback, recurring && this.resetAnim(), callback) {
        case "loop":
          break;
        case "once":
          /** @type {number} */
          this.maxIdx = this.oAnims[this.animId].length - 1;
      }
    }, Camera.prototype.render = function (ctx) {
      if (null != this.animId) {
        var spaces1 = this.oAnims[this.animId].length;
        /** @type {number} */
        var num1 = Math.floor(this.frameInc);
        var sectionLength = this.oAnims[this.animId][num1 % spaces1];
        /** @type {number} */
        var startX = sectionLength * this.oImgData.oData.spriteWidth % this.oImgData.img.width;
        /** @type {number} */
        var offsetY = Math.floor(sectionLength / (this.oImgData.img.width / this.oImgData.oData.spriteWidth)) * this.oImgData.oData.spriteHeight;
        if ("once" == this.animType && num1 > this.maxIdx) {
          this.fixedFrame = this.oAnims[this.animId][spaces1 - 1];
          /** @type {null} */
          this.animId = null;
          this.animEndedFunc();
          /** @type {number} */
          startX = this.fixedFrame * this.oImgData.oData.spriteWidth % this.oImgData.img.width;
          /** @type {number} */
          offsetY = Math.floor(this.fixedFrame / (this.oImgData.img.width / this.oImgData.oData.spriteWidth)) * this.oImgData.oData.spriteHeight;
        }
      } else {
        /** @type {number} */
        startX = this.fixedFrame * this.oImgData.oData.spriteWidth % this.oImgData.img.width;
        /** @type {number} */
        offsetY = Math.floor(this.fixedFrame / (this.oImgData.img.width / this.oImgData.oData.spriteWidth)) * this.oImgData.oData.spriteHeight;
      }
      ctx.drawImage(this.oImgData.img, startX, offsetY, this.oImgData.oData.spriteWidth, this.oImgData.oData.spriteHeight, -this.oImgData.oData.spriteWidth / 2 + this.offsetX, -this.oImgData.oData.spriteHeight / 2 + this.offsetY, this.oImgData.oData.spriteWidth, this.oImgData.oData.spriteHeight);
    }, Camera;
  }();
  eventHandle.AnimSprite = elem;
}(Utils || (Utils = {}));
! function (eventHandle) {
  var elem = function () {
    /**
     * @param {?} far
     * @param {Blob} radius
     * @return {undefined}
     */
    function Camera(far, radius) {
      /** @type {number} */
      this.x = 0;
      /** @type {number} */
      this.y = 0;
      /** @type {number} */
      this.rotation = 0;
      /** @type {number} */
      this.radius = 10;
      /** @type {boolean} */
      this.removeMe = false;
      /** @type {number} */
      this.offsetX = 0;
      /** @type {number} */
      this.offsetY = 0;
      /** @type {number} */
      this.scaleX = 1;
      /** @type {number} */
      this.scaleY = 1;
      this.oImgData = far;
      /** @type {Blob} */
      this.radius = radius;
    }
    return Camera.prototype.setFrame = function (b) {
      this.frameNum = b;
    }, Camera.prototype.render = function (ctx) {
      /** @type {number} */
      var startX = this.frameNum * this.oImgData.oData.spriteWidth % this.oImgData.img.width;
      /** @type {number} */
      var offsetY = Math.floor(this.frameNum / (this.oImgData.img.width / this.oImgData.oData.spriteWidth)) * this.oImgData.oData.spriteHeight;
      ctx.drawImage(this.oImgData.img, startX, offsetY, this.oImgData.oData.spriteWidth, this.oImgData.oData.spriteHeight, -this.oImgData.oData.spriteWidth / 2 + this.offsetX, -this.oImgData.oData.spriteHeight / 2 + this.offsetY, this.oImgData.oData.spriteWidth, this.oImgData.oData.spriteHeight);
    }, Camera;
  }();
  eventHandle.BasicSprite = elem;
}(Utils || (Utils = {}));
! function (eventHandle) {
  var elem = function () {
    /**
     * @param {HTMLElement} el
     * @param {?} allBindingsAccessor
     * @return {undefined}
     */
    function init(el, allBindingsAccessor) {
      var self = this;
      /** @type {number} */
      this.canvasX = 0;
      /** @type {number} */
      this.canvasY = 0;
      /** @type {number} */
      this.canvasScaleX = 1;
      /** @type {number} */
      this.canvasScaleY = 1;
      /** @type {number} */
      this.prevHitTime = 0;
      /** @type {boolean} */
      this.pauseIsOn = false;
      /** @type {boolean} */
      this.isDown = false;
      /** @type {boolean} */
      this.isDetectingKeys = false;
      this.isBugBrowser = allBindingsAccessor;
      el.addEventListener("touchstart", function (e) {
        /** @type {number} */
        var i = 0;
        for (; i < e.changedTouches.length; i++) {
          self.hitDown(e, e.changedTouches[i].pageX, e.changedTouches[i].pageY, e.changedTouches[i].identifier);
        }
      }, false);
      el.addEventListener("touchend", function (e) {
        /** @type {number} */
        var i = 0;
        for (; i < e.changedTouches.length; i++) {
          self.hitUp(e, e.changedTouches[i].pageX, e.changedTouches[i].pageY, e.changedTouches[i].identifier);
        }
      }, false);
      el.addEventListener("touchleave", function (e) {
        /** @type {number} */
        var i = 0;
        for (; i < e.changedTouches.length; i++) {
          self.leave(e, e.changedTouches[i].pageX, e.changedTouches[i].pageY, e.changedTouches[i].identifier);
        }
      }, false);
      el.addEventListener("touchmove", function (e) {
        /** @type {number} */
        var i = 0;
        for (; i < self.aHitAreas.length; i++) {
          if (void 0 != e.changedTouches[i]) {
            self.move(e, e.changedTouches[i].pageX, e.changedTouches[i].pageY, e.changedTouches[i].identifier, true);
          }
        }
      }, false);
      el.addEventListener("mousedown", function (event) {
        /** @type {boolean} */
        self.isDown = true;
        self.hitDown(event, event.pageX, event.pageY, 1);
      }, false);
      el.addEventListener("mouseup", function (event) {
        /** @type {boolean} */
        self.isDown = false;
        self.hitUp(event, event.pageX, event.pageY, 1);
      }, false);
      el.addEventListener("mouseleave", function (data) {
        self.leave(data, data.pageX, data.pageY, 1);
      }, false);
      el.addEventListener("mousemove", function (e) {
        self.move(e, e.pageX, e.pageY, 1, self.isDown);
      }, false);
      /** @type {Array} */
      this.aHitAreas = new Array;
      /** @type {Array} */
      this.aKeys = new Array;
    }
    return init.prototype.setCanvas = function (canvasX, canvasY, lanyardCanvas, dataAndEvents) {
      /** @type {number} */
      this.canvasX = canvasX;
      /** @type {number} */
      this.canvasY = canvasY;
      /** @type {number} */
      this.canvasScaleX = lanyardCanvas;
      /** @type {number} */
      this.canvasScaleY = dataAndEvents;
    }, init.prototype.hitDown = function (event, hour, minute, ensure) {
      if (!this.pauseIsOn) {
        /** @type {number} */
        var prevHitTime = (new Date).getTime();
        if (!(prevHitTime - this.prevHitTime < 500 && isBugBrowser)) {
          /** @type {number} */
          this.prevHitTime = prevHitTime;
          event.preventDefault();
          event.stopPropagation();
          /** @type {number} */
          hour = (hour - this.canvasX) * this.canvasScaleX;
          /** @type {number} */
          minute = (minute - this.canvasY) * this.canvasScaleY;
          /** @type {number} */
          var i = 0;
          for (; i < this.aHitAreas.length; i++) {
            if (this.aHitAreas[i].rect && (hour > this.aHitAreas[i].area[0] && (minute > this.aHitAreas[i].area[1] && (hour < this.aHitAreas[i].area[2] && minute < this.aHitAreas[i].area[3])))) {
              this.aHitAreas[i].aTouchIdentifiers.push(ensure);
              if (!this.aHitAreas[i].oData.isDown) {
                /** @type {boolean} */
                this.aHitAreas[i].oData.isDown = true;
                this.aHitAreas[i].callback(this.aHitAreas[i].id, this.aHitAreas[i].oData);
              }
              break;
            }
          }
        }
      }
    }, init.prototype.hitUp = function (event, hour, minute, dataAndEvents) {
      if (!this.pauseIsOn) {
        event.preventDefault();
        event.stopPropagation();
        /** @type {number} */
        hour = (hour - this.canvasX) * this.canvasScaleX;
        /** @type {number} */
        minute = (minute - this.canvasY) * this.canvasScaleY;
        /** @type {number} */
        var i = 0;
        for (; i < this.aHitAreas.length; i++) {
          if (this.aHitAreas[i].rect && (hour > this.aHitAreas[i].area[0] && (minute > this.aHitAreas[i].area[1] && (hour < this.aHitAreas[i].area[2] && minute < this.aHitAreas[i].area[3])))) {
            /** @type {number} */
            var it = 0;
            for (; it < this.aHitAreas[i].aTouchIdentifiers.length; it++) {
              if (this.aHitAreas[i].aTouchIdentifiers[it] == dataAndEvents) {
                this.aHitAreas[i].aTouchIdentifiers.splice(it, 1);
                it -= 1;
              }
            }
            if (0 == this.aHitAreas[i].aTouchIdentifiers.length) {
              /** @type {boolean} */
              this.aHitAreas[i].oData.isDown = false;
              if (this.aHitAreas[i].oData.multiTouch) {
                this.aHitAreas[i].callback(this.aHitAreas[i].id, this.aHitAreas[i].oData);
              }
            }
          }
        }
      }
    }, init.prototype.move = function (edge, x, y, row, dataAndEvents) {
      if (!this.pauseIsOn && dataAndEvents) {
        /** @type {number} */
        x = (x - this.canvasX) * this.canvasScaleX;
        /** @type {number} */
        y = (y - this.canvasY) * this.canvasScaleY;
        /** @type {number} */
        var i = 0;
        for (; i < this.aHitAreas.length; i++) {
          if (this.aHitAreas[i].rect) {
            if (x > this.aHitAreas[i].area[0] && (y > this.aHitAreas[i].area[1] && (x < this.aHitAreas[i].area[2] && y < this.aHitAreas[i].area[3]))) {
              if (!this.aHitAreas[i].oData.isDown) {
                /** @type {boolean} */
                this.aHitAreas[i].oData.isDown = true;
                this.aHitAreas[i].aTouchIdentifiers.push(row);
                if (this.aHitAreas[i].oData.multiTouch) {
                  this.aHitAreas[i].callback(this.aHitAreas[i].id, this.aHitAreas[i].oData);
                }
              }
              if (this.aHitAreas[i].oData.isDraggable) {
                /** @type {boolean} */
                this.aHitAreas[i].oData.isBeingDragged = true;
                /** @type {number} */
                this.aHitAreas[i].oData.posX = x;
                /** @type {number} */
                this.aHitAreas[i].oData.posY = y;
                this.aHitAreas[i].callback(this.aHitAreas[i].id, this.aHitAreas[i].oData);
                /** @type {boolean} */
                this.aHitAreas[i].oData.isBeingDragged = false;
              }
            } else {
              if (this.aHitAreas[i].oData.isDown) {
                /** @type {number} */
                var n = 0;
                for (; n < this.aHitAreas[i].aTouchIdentifiers.length; n++) {
                  if (this.aHitAreas[i].aTouchIdentifiers[n] == row) {
                    this.aHitAreas[i].aTouchIdentifiers.splice(n, 1);
                    n -= 1;
                  }
                }
                if (0 == this.aHitAreas[i].aTouchIdentifiers.length) {
                  /** @type {boolean} */
                  this.aHitAreas[i].oData.isDown = false;
                  if (this.aHitAreas[i].oData.multiTouch) {
                    this.aHitAreas[i].callback(this.aHitAreas[i].id, this.aHitAreas[i].oData);
                  }
                }
              }
            }
          }
        }
      }
    }, init.prototype.leave = function (e, element, inSender, dataAndEvents) {
      if (!this.pauseIsOn) {
        e.preventDefault();
        e.stopPropagation();
        /** @type {boolean} */
        this.isDown = false;
        /** @type {number} */
        var i = 0;
        for (; i < this.aHitAreas.length; i++) {
          if (this.aHitAreas[i].aTouchIdentifiers.length > 0) {
            /** @type {number} */
            var it = 0;
            for (; it < this.aHitAreas[i].aTouchIdentifiers.length; it++) {
              if (this.aHitAreas[i].aTouchIdentifiers[it] == dataAndEvents) {
                this.aHitAreas[i].aTouchIdentifiers.splice(it, 1);
                it -= 1;
              }
            }
            if (0 == this.aHitAreas[i].aTouchIdentifiers.length) {
              /** @type {boolean} */
              this.aHitAreas[i].oData.isDown = false;
              this.aHitAreas[i].callback(this.aHitAreas[i].id, this.aHitAreas[i].oData);
            }
            break;
          }
        }
      }
    }, init.prototype.keyDown = function (ev) {
      /** @type {number} */
      var i = 0;
      for (; i < this.aKeys.length; i++) {
        if (ev.keyCode == this.aKeys[i].keyCode) {
          /** @type {boolean} */
          this.aKeys[i].oData.isDown = true;
          this.aKeys[i].callback(this.aKeys[i].id, this.aKeys[i].oData);
        }
      }
    }, init.prototype.keyUp = function (e) {
      /** @type {number} */
      var i = 0;
      for (; i < this.aKeys.length; i++) {
        if (e.keyCode == this.aKeys[i].keyCode) {
          /** @type {boolean} */
          this.aKeys[i].oData.isDown = false;
          this.aKeys[i].callback(this.aKeys[i].id, this.aKeys[i].oData);
        }
      }
    }, init.prototype.addKey = function (sessionId, callback, value, key) {
      var self = this;
      if (!this.isDetectingKeys) {
        window.addEventListener("keydown", function (ev) {
          self.keyDown(ev);
        }, false);
        window.addEventListener("keyup", function (e) {
          self.keyUp(e);
        }, false);
        /** @type {boolean} */
        this.isDetectingKeys = true;
      }
      if (null == value) {
        /** @type {Object} */
        value = new Object;
      }
      this.aKeys.push({
        id: sessionId,
        /** @type {Function} */
        callback: callback,
        oData: value,
        keyCode: key
      });
    }, init.prototype.removeKey = function (value) {
      /** @type {number} */
      var i = 0;
      for (; i < this.aKeys.length; i++) {
        if (this.aKeys[i].id == value) {
          this.aKeys.splice(i, 1);
          i -= 1;
        }
      }
    }, init.prototype.addHitArea = function (name, callback, min1, opt_attributes, dataAndEvents) {
      if ("undefined" == typeof dataAndEvents) {
        /** @type {boolean} */
        dataAndEvents = false;
      }
      if (null == min1) {
        /** @type {Object} */
        min1 = new Object;
      }
      if (dataAndEvents) {
        this.removeHitArea(name);
      }
      /** @type {Array} */
      var other = new Array;
      switch (opt_attributes.type) {
        case "image":
          if (opt_attributes.oImageData.isSpriteSheet) {
            this.aHitAreas.push({
              id: name,
              aTouchIdentifiers: other,
              /** @type {Function} */
              callback: callback,
              oData: min1,
              rect: true,
              area: [opt_attributes.aCentrePos[0] - opt_attributes.oImageData.oData.spriteHeight / 2, opt_attributes.aCentrePos[1] - opt_attributes.oImageData.oData.spriteHeight / 2, opt_attributes.aCentrePos[0] + opt_attributes.oImageData.oData.spriteWidth / 2, opt_attributes.aCentrePos[1] + opt_attributes.oImageData.oData.spriteHeight / 2]
            });
          } else {
            this.aHitAreas.push({
              id: name,
              aTouchIdentifiers: other,
              /** @type {Function} */
              callback: callback,
              oData: min1,
              rect: true,
              area: [opt_attributes.aCentrePos[0] - opt_attributes.oImageData.img.width / 2, opt_attributes.aCentrePos[1] - opt_attributes.oImageData.img.height / 2, opt_attributes.aCentrePos[0] + opt_attributes.oImageData.img.width / 2, opt_attributes.aCentrePos[1] + opt_attributes.oImageData.img.height / 2]
            });
          }
          break;
        case "rect":
          this.aHitAreas.push({
            id: name,
            aTouchIdentifiers: other,
            /** @type {Function} */
            callback: callback,
            oData: min1,
            rect: true,
            area: opt_attributes.aRect
          });
      }
    }, init.prototype.removeHitArea = function (name) {
      /** @type {number} */
      var i = 0;
      for (; i < this.aHitAreas.length; i++) {
        if (this.aHitAreas[i].id == name) {
          this.aHitAreas.splice(i, 1);
          i -= 1;
        }
      }
    }, init;
  }();
  eventHandle.UserInput = elem;
}(Utils || (Utils = {}));
! function (dataAndEvents) {
  var FpsMeter = function () {
    /**
     * @param {number} rows
     * @return {undefined}
     */
    function render(rows) {
      /** @type {number} */
      this.updateFreq = 10;
      /** @type {number} */
      this.updateInc = 0;
      /** @type {number} */
      this.frameAverage = 0;
      /** @type {number} */
      this.display = 1;
      /** @type {string} */
      this.log = "";
      /**
       * @param {CanvasRenderingContext2D} context
       * @return {undefined}
       */
      this.render = function (context) {
        this.frameAverage += this.delta / this.updateFreq;
        if (++this.updateInc >= this.updateFreq) {
          /** @type {number} */
          this.updateInc = 0;
          this.display = this.frameAverage;
          /** @type {number} */
          this.frameAverage = 0;
        }
        /** @type {string} */
        context.textAlign = "left";
        /** @type {string} */
        ctx.font = "10px Helvetica";
        /** @type {string} */
        context.fillStyle = "#333333";
        context.beginPath();
        context.rect(0, this.canvasHeight - 15, 40, 15);
        context.closePath();
        context.fill();
        /** @type {string} */
        context.fillStyle = "#ffffff";
        context.fillText(Math.round(1E3 / (1E3 * this.display)) + " fps " + this.log, 5, this.canvasHeight - 5);
      };
      /** @type {number} */
      this.canvasHeight = rows;
    }
    return render.prototype.update = function (delta) {
      this.delta = delta;
    }, render;
  }();
  dataAndEvents.FpsMeter = FpsMeter;
}(Utils || (Utils = {}));
var Elements;
! function (eventHandle) {
  var elem = function () {
    /**
     * @param {?} line
     * @param {number} _arg
     * @param {?} parentEl
     * @return {undefined}
     */
    function Text(line, _arg, parentEl) {
      /** @type {number} */
      this.x = 0;
      /** @type {number} */
      this.y = 0;
      /** @type {number} */
      this.targY = 0;
      /** @type {number} */
      this.incY = 0;
      this.oImgData = line;
      /** @type {number} */
      this.canvasWidth = _arg;
      this.canvasHeight = parentEl;
    }
    return Text.prototype.startScroll = function (opt_attributes) {
      this.targY -= 5 * opt_attributes;
      TweenLite.killTweensOf(this);
      TweenLite.to(this, 4, {
        y: this.targY,
        ease: "Quad.easeOut"
      });
    }, Text.prototype.updateScroll = function (e) {
      this.incY += 5 * e;
      /** @type {number} */
      this.x = this.x - 50 * Math.sin(this.incY / 10) * e;
      /** @type {number} */
      this.y = this.y - 50 * e;
    }, Text.prototype.render = function (ctx) {
      /** @type {number} */
      this.x = this.x % this.canvasWidth;
      /** @type {number} */
      this.y = this.y % this.canvasHeight;
      if (this.x < 0) {
        this.x += this.canvasWidth;
      }
      if (this.y < 0) {
        this.y += this.canvasHeight;
      }
      ctx.drawImage(this.oImgData.img, this.x, this.y, this.canvasWidth, this.canvasHeight, 0, 0, this.canvasWidth, this.canvasHeight);
    }, Text;
  }();
  eventHandle.Background = elem;
}(Elements || (Elements = {}));
! function (eventHandle) {
  var elem = function () {
    /**
     * @param {?} Mh
     * @param {?} Mw
     * @param {?} span
     * @param {number} canvasWidth
     * @param {number} canvasHeight
     * @return {undefined}
     */
    function Zoom(Mh, Mw, span, canvasWidth, canvasHeight) {
      /** @type {number} */
      this.incY = 0;
      /** @type {number} */
      this.score = 0;
      /** @type {number} */
      this.highestScore = 0;
      /** @type {number} */
      this.posY = 0;
      /** @type {number} */
      this.bgX = 0;
      /** @type {number} */
      this.bgY = 0;
      /** @type {number} */
      this.atmosX = 0;
      /** @type {number} */
      this.atmosY = 0;
      this.oButs = Mh;
      this.oBgImgData = Mw;
      this.oTitleImgData = span;
      /** @type {number} */
      this.canvasWidth = canvasWidth;
      /** @type {number} */
      this.canvasHeight = canvasHeight;
      /** @type {number} */
      this.posY = -this.canvasHeight;
    }
    return Zoom.prototype.setRenderFunc = function (dataAndEvents) {
      switch (this.posY = -this.canvasHeight, dataAndEvents) {
        case "start":
          this.renderFunc = this.renderStartScreen;
          TweenLite.to(this, 0.5, {
            posY: 0
          });
          break;
        case "help":
          break;
        case "end":
          ;
      }
    }, Zoom.prototype.render = function (delta, deepDataAndEvents) {
      this.renderFunc(delta, deepDataAndEvents);
    }, Zoom.prototype.renderStartScreen = function (ctx, deepDataAndEvents) {
      this.incY += 5 * deepDataAndEvents;
      this.bgY -= 50 * deepDataAndEvents;
      this.bgX -= 50 * Math.sin(this.incY / 10) * deepDataAndEvents;
      /** @type {number} */
      var startX = this.bgX % this.canvasWidth;
      /** @type {number} */
      var offsetY = this.bgY % this.canvasHeight;
      if (0 > startX) {
        startX += this.canvasWidth;
      }
      if (0 > offsetY) {
        offsetY += this.canvasHeight;
      }
      ctx.drawImage(this.oBgImgData.img, startX, offsetY, this.canvasWidth, this.canvasHeight, 0, 0, this.canvasWidth, this.canvasHeight);
      ctx.drawImage(this.oTitleImgData.img, 15 + this.posY, 60);
      ctx.drawImage(this.oButs.play.imageData.img, this.oButs.play.pos[0] - this.oButs.play.imageData.img.width / 2, this.oButs.play.pos[1] - this.oButs.play.imageData.img.height / 2 - 5 * Math.sin(this.incY) - this.posY);
      ctx.drawImage(this.oButs.moreGames.imageData.img, this.oButs.moreGames.pos[0] - this.oButs.moreGames.imageData.img.width / 2, this.oButs.moreGames.pos[1] - this.oButs.moreGames.imageData.img.height / 2 - 5 * Math.sin(this.incY) - this.posY);
    }, Zoom;
  }();
  eventHandle.Screens = elem;
}(Elements || (Elements = {}));
! function (eventHandle) {
  var elem = function () {
    /**
     * @param {?} contentHTML
     * @param {number} canvasWidth
     * @param {number} canvasHeight
     * @return {undefined}
     */
    function initialize(contentHTML, canvasWidth, canvasHeight) {
      /** @type {number} */
      this.inc = 0;
      this.oSplashScreenImgData = contentHTML;
      /** @type {number} */
      this.canvasWidth = canvasWidth;
      /** @type {number} */
      this.canvasHeight = canvasHeight;
      /** @type {number} */
      this.posY = -this.canvasHeight;
      TweenLite.to(this, 0.5, {
        posY: 0
      });
    }
    return initialize.prototype.render = function (ctx, delta) {
      this.inc += 5 * delta;
      ctx.drawImage(this.oSplashScreenImgData.img, 0, 0 - this.posY);
    }, initialize;
  }();
  eventHandle.Splash = elem;
}(Elements || (Elements = {}));
! function (Stopwatch) {
  var stopwatchPanel = function () {
    /**
     * @param {?} initialState
     * @param {?} debugMode
     * @param {?} round
     * @param {?} sock
     * @param {?} rootModel
     * @param {?} canvasWidth
     * @param {number} canvasHeight
     * @return {undefined}
     */
    function Game(initialState, debugMode, round, sock, rootModel, canvasWidth, canvasHeight) {
      /** @type {number} */
      this.timer = 0.3;
      /** @type {number} */
      this.endTime = 0;
      /** @type {number} */
      this.posY = 0;
      /** @type {number} */
      this.numberSpace = 17;
      /** @type {number} */
      this.incY = 0;
      this.oPanelsImgData = initialState;
      this.oThinNumbersImgData = debugMode;
      this.oFatNumbersImgData = round;
      this.panelType = sock;
      this.aButs = rootModel;
      this.canvasWidth = canvasWidth;
      /** @type {number} */
      this.canvasHeight = canvasHeight;
    }
    return Game.prototype.update = function (delta) {
      this.incY += 5 * delta;
    }, Game.prototype.startTween = function () {
      /** @type {number} */
      this.posY = 550;
      TweenLite.to(this, 0.8, {
        posY: 0,
        ease: "Back.easeOut"
      });
    }, Game.prototype.render = function (ctx) {
      switch (this.panelType) {
        case "start":
          /** @type {number} */
          var width = 6;
          /** @type {number} */
          var startX = width * this.oPanelsImgData.oData.spriteWidth % this.oPanelsImgData.img.width;
          /** @type {number} */
          var offsetY = Math.floor(width / (this.oPanelsImgData.img.width / this.oPanelsImgData.oData.spriteWidth)) * this.oPanelsImgData.oData.spriteHeight;
          ctx.drawImage(this.oPanelsImgData.img, startX, offsetY, this.oPanelsImgData.oData.spriteWidth, this.oPanelsImgData.oData.spriteHeight, 0, 0 + this.posY - 20, this.oPanelsImgData.oData.spriteWidth, this.oPanelsImgData.oData.spriteHeight);
          break;
        case "gameOver":
          /** @type {number} */
          width = 5;
          /** @type {number} */
          startX = width * this.oPanelsImgData.oData.spriteWidth % this.oPanelsImgData.img.width;
          /** @type {number} */
          offsetY = Math.floor(width / (this.oPanelsImgData.img.width / this.oPanelsImgData.oData.spriteWidth)) * this.oPanelsImgData.oData.spriteHeight;
          ctx.drawImage(this.oPanelsImgData.img, startX, offsetY, this.oPanelsImgData.oData.spriteWidth, this.oPanelsImgData.oData.spriteHeight, 0, 0 + this.posY, this.oPanelsImgData.oData.spriteWidth, this.oPanelsImgData.oData.spriteHeight);
          var dstUri = this.oScoreData.gameScore;
          /** @type {number} */
          var n = 0;
          for (; n < dstUri.toString().length; n++) {
            /** @type {number} */
            width = parseFloat(dstUri.toString().charAt(n));
            /** @type {number} */
            startX = width * this.oFatNumbersImgData.oData.spriteWidth % this.oFatNumbersImgData.img.width;
            /** @type {number} */
            offsetY = Math.floor(width / (this.oFatNumbersImgData.img.width / this.oFatNumbersImgData.oData.spriteWidth)) * this.oFatNumbersImgData.oData.spriteHeight;
            ctx.drawImage(this.oFatNumbersImgData.img, startX, offsetY, this.oFatNumbersImgData.oData.spriteWidth, this.oFatNumbersImgData.oData.spriteHeight, this.canvasWidth / 2 + 25 * n - 25 * dstUri.toString().length / 2, 193 + this.posY, this.oFatNumbersImgData.oData.spriteWidth, this.oFatNumbersImgData.oData.spriteHeight);
          }
          dstUri = this.oScoreData.longestChain;
          /** @type {number} */
          n = 0;
          for (; n < dstUri.toString().length; n++) {
            /** @type {number} */
            width = parseFloat(dstUri.toString().charAt(n));
            /** @type {number} */
            startX = width * this.oThinNumbersImgData.oData.spriteWidth % this.oThinNumbersImgData.img.width;
            /** @type {number} */
            offsetY = Math.floor(width / (this.oThinNumbersImgData.img.width / this.oThinNumbersImgData.oData.spriteWidth)) * this.oThinNumbersImgData.oData.spriteHeight;
            ctx.drawImage(this.oThinNumbersImgData.img, startX, offsetY, this.oThinNumbersImgData.oData.spriteWidth, this.oThinNumbersImgData.oData.spriteHeight, 224 + n * this.numberSpace, 253 + this.posY, this.oThinNumbersImgData.oData.spriteWidth, this.oThinNumbersImgData.oData.spriteHeight);
          }
          dstUri = this.oScoreData.balloonsPopped;
          /** @type {number} */
          n = 0;
          for (; n < dstUri.toString().length; n++) {
            /** @type {number} */
            width = parseFloat(dstUri.toString().charAt(n));
            /** @type {number} */
            startX = width * this.oThinNumbersImgData.oData.spriteWidth % this.oThinNumbersImgData.img.width;
            /** @type {number} */
            offsetY = Math.floor(width / (this.oThinNumbersImgData.img.width / this.oThinNumbersImgData.oData.spriteWidth)) * this.oThinNumbersImgData.oData.spriteHeight;
            ctx.drawImage(this.oThinNumbersImgData.img, startX, offsetY, this.oThinNumbersImgData.oData.spriteWidth, this.oThinNumbersImgData.oData.spriteHeight, 253 + n * this.numberSpace, 286 + this.posY, this.oThinNumbersImgData.oData.spriteWidth, this.oThinNumbersImgData.oData.spriteHeight);
          }
          dstUri = this.oScoreData.highScore;
          /** @type {number} */
          n = 0;
          for (; n < dstUri.toString().length; n++) {
            /** @type {number} */
            width = parseFloat(dstUri.toString().charAt(n));
            /** @type {number} */
            startX = width * this.oThinNumbersImgData.oData.spriteWidth % this.oThinNumbersImgData.img.width;
            /** @type {number} */
            offsetY = Math.floor(width / (this.oThinNumbersImgData.img.width / this.oThinNumbersImgData.oData.spriteWidth)) * this.oThinNumbersImgData.oData.spriteHeight;
            ctx.drawImage(this.oThinNumbersImgData.img, startX, offsetY, this.oThinNumbersImgData.oData.spriteWidth, this.oThinNumbersImgData.oData.spriteHeight, 186 + n * this.numberSpace, 342 + this.posY, this.oThinNumbersImgData.oData.spriteWidth, this.oThinNumbersImgData.oData.spriteHeight);
          }
          break;
        case "tutorial0":
          ;
        case "tutorial1":
          ;
        case "tutorial2":
          ;
        case "tutorial3":
          ;
        case "tutorial4":
          /** @type {number} */
          width = parseFloat(this.panelType.charAt(this.panelType.length - 1));
          /** @type {number} */
          startX = width * this.oPanelsImgData.oData.spriteWidth % this.oPanelsImgData.img.width;
          /** @type {number} */
          offsetY = Math.floor(width / (this.oPanelsImgData.img.width / this.oPanelsImgData.oData.spriteWidth)) * this.oPanelsImgData.oData.spriteHeight;
          ctx.drawImage(this.oPanelsImgData.img, startX, offsetY, this.oPanelsImgData.oData.spriteWidth, this.oPanelsImgData.oData.spriteHeight, 0, 0 + this.posY, this.oPanelsImgData.oData.spriteWidth, this.oPanelsImgData.oData.spriteHeight);
          break;
        case "pause":
          /** @type {number} */
          width = 7;
          /** @type {number} */
          startX = width * this.oPanelsImgData.oData.spriteWidth % this.oPanelsImgData.img.width;
          /** @type {number} */
          offsetY = Math.floor(width / (this.oPanelsImgData.img.width / this.oPanelsImgData.oData.spriteWidth)) * this.oPanelsImgData.oData.spriteHeight;
          ctx.drawImage(this.oPanelsImgData.img, startX, offsetY, this.oPanelsImgData.oData.spriteWidth, this.oPanelsImgData.oData.spriteHeight, 0, 0, this.oPanelsImgData.oData.spriteWidth, this.oPanelsImgData.oData.spriteHeight);
      }
      /** @type {number} */
      n = 0;
      for (; n < this.aButs.length; n++) {
        if (0 == n % 2) {
          ctx.drawImage(this.aButs[n].oImgData.img, this.aButs[n].aPos[0] - this.aButs[n].oImgData.img.width / 2 + this.posY, this.aButs[n].aPos[1] - this.aButs[n].oImgData.img.height / 2 - 5 * Math.sin(this.incY + 180));
        } else {
          ctx.drawImage(this.aButs[n].oImgData.img, this.aButs[n].aPos[0] - this.aButs[n].oImgData.img.width / 2 - this.posY, this.aButs[n].aPos[1] - this.aButs[n].oImgData.img.height / 2 - 5 * Math.sin(this.incY));
        }
      }
    }, Game;
  }();
  Stopwatch.Panel = stopwatchPanel;
}(Elements || (Elements = {}));
! function (eventHandle) {
  var elem = function () {
    /**
     * @param {?} initialState
     * @param {?} debugMode
     * @param {?} round
     * @param {?} canvasWidth
     * @param {?} canvasHeight
     * @return {undefined}
     */
    function Game(initialState, debugMode, round, canvasWidth, canvasHeight) {
      /** @type {number} */
      this.score = 0;
      this.oHudImgData = initialState;
      this.oThinNumbersImgData = debugMode;
      this.oFatNumbersImgData = round;
      this.canvasWidth = canvasWidth;
      this.canvasHeight = canvasHeight;
      /** @type {number} */
      this.score = 0;
    }
    return Game.prototype.render = function (ctx, delta) {
      ctx.drawImage(this.oHudImgData.img, 0, 0);
      /** @type {number} */
      var n = 0;
      for (; n < this.score.toString().length; n++) {
        /** @type {number} */
        var key = parseFloat(this.score.toString().charAt(n));
        /** @type {number} */
        var startX = key * this.oFatNumbersImgData.oData.spriteWidth % this.oFatNumbersImgData.img.width;
        /** @type {number} */
        var offsetY = Math.floor(key / (this.oFatNumbersImgData.img.width / this.oFatNumbersImgData.oData.spriteWidth)) * this.oFatNumbersImgData.oData.spriteHeight;
        ctx.drawImage(this.oFatNumbersImgData.img, startX, offsetY, this.oFatNumbersImgData.oData.spriteWidth, this.oFatNumbersImgData.oData.spriteHeight, 175 + 25 * n - 25 * this.score.toString().length / 2, 18, this.oFatNumbersImgData.oData.spriteWidth, this.oFatNumbersImgData.oData.spriteHeight);
      }
      /** @type {number} */
      n = 0;
      for (; n < delta.toString().length; n++) {
        /** @type {number} */
        key = parseFloat(delta.toString().charAt(n));
        /** @type {number} */
        startX = key * this.oThinNumbersImgData.oData.spriteWidth % this.oThinNumbersImgData.img.width;
        /** @type {number} */
        offsetY = Math.floor(key / (this.oThinNumbersImgData.img.width / this.oThinNumbersImgData.oData.spriteWidth)) * this.oThinNumbersImgData.oData.spriteHeight;
        ctx.drawImage(this.oThinNumbersImgData.img, startX, offsetY, this.oThinNumbersImgData.oData.spriteWidth, this.oThinNumbersImgData.oData.spriteHeight, 31 + 17 * n - 17 * delta.toString().length / 2, 22, this.oThinNumbersImgData.oData.spriteWidth, this.oThinNumbersImgData.oData.spriteHeight);
      }
    }, Game.prototype.updateScore = function (score) {
      /** @type {number} */
      this.score = score;
    }, Game;
  }();
  eventHandle.Hud = elem;
}(Elements || (Elements = {}));
/** @type {function (Object, Function): undefined} */
var __extends = this.__extends || function (d, b) {
  /**
   * @return {undefined}
   */
  function __() {
    /** @type {Object} */
    this.constructor = d;
  }
  __.prototype = b.prototype;
  d.prototype = new __;
};
! function (exports) {
  var EventEmitter = function (_super) {
    /**
     * @param {?} name
     * @param {?} err
     * @param {number} key
     * @param {number} colour
     * @param {number} canvasWidth
     * @param {?} canvasHeight
     * @return {undefined}
     */
    function self(name, err, key, colour, canvasWidth, canvasHeight) {
      _super.call(this, name, 15, 15, "unSelected" + colour);
      /** @type {boolean} */
      this.canHit = true;
      /** @type {boolean} */
      this.selected = false;
      /** @type {number} */
      this.popDelay = -1;
      this.oDotImgData = name;
      this.oPopImgData = err;
      /** @type {number} */
      this.id = key;
      this.type = this.colour = colour;
      /** @type {number} */
      this.canvasWidth = canvasWidth;
      this.canvasHeight = canvasHeight;
      /** @type {number} */
      this.offsetY = 10;
      /** @type {number} */
      this.frameInc = Math.ceil(20 * Math.random());
      this.animEndedFunc = this.burst;
    }
    return __extends(self, _super), self.prototype.fall = function () {
      this.y = this.targY + 550;
      this.x = this.targX;
      TweenLite.to(this, 0.5, {
        y: this.targY,
        delay: 0.02 * this.id,
        ease: "Quad.easeOut"
      });
    }, self.prototype.replaceWithExistingDot = function (evt) {
      this.y = evt.targY;
      this.type = evt.type;
      /** @type {boolean} */
      this.removeMe = false;
      /** @type {boolean} */
      this.canHit = true;
      this.x = this.targX;
      this.changeSpriteSheet(this.oDotImgData);
      this.frameInc = evt.frameInc;
      this.unSelect();
      TweenLite.to(this, 0.5, {
        y: this.targY,
        ease: "Quad.easeInOut"
      });
    }, self.prototype.replaceWithNewDot = function (eventType) {
      this.y = this.targY + 550;
      /** @type {number} */
      this.type = eventType;
      /** @type {boolean} */
      this.removeMe = false;
      /** @type {boolean} */
      this.canHit = true;
      this.x = this.targX;
      this.changeSpriteSheet(this.oDotImgData);
      /** @type {number} */
      this.frameInc = Math.ceil(20 * Math.random());
      this.unSelect();
      TweenLite.to(this, 0.5, {
        y: this.targY,
        ease: "Quad.easeOut"
      });
    }, self.prototype.trySelect = function (p) {
      /** @type {number} */
      var z0 = p.x - this.x;
      /** @type {number} */
      var z1 = p.targY - this.targY;
      /** @type {number} */
      var d = z0 * z0 + z1 * z1;
      return 8100 > d && (p.colour == this.colour || (this.type >= 6 || 6 == p.type)) ? (this.select(), this.type >= 7 && (this.colour = p.colour), this.prevDot = p, this) : p;
    }, self.prototype.select = function () {
      if (!this.selected) {
        this.setAnimType("loop", "selected" + this.type, false);
        /** @type {boolean} */
        this.selected = true;
      }
    }, self.prototype.unSelect = function () {
      this.setAnimType("loop", "unSelected" + this.type, false);
      /** @type {boolean} */
      this.selected = false;
      this.colour = this.type;
    }, self.prototype.update = function (delta) {
      _super.prototype.updateAnimation.call(this, delta);
      if (this.popDelay >= 0) {
        this.popDelay += delta;
        if (this.popDelay > this.popDelayTarg) {
          this.pop();
        }
      }
    }, self.prototype.hit = function (x2) {
      /** @type {number} */
      this.popDelay = 0;
      /** @type {number} */
      this.popDelayTarg = 0.25 * x2;
    }, self.prototype.pop = function () {
      /** @type {number} */
      this.popDelay = -1;
      this.changeSpriteSheet(this.oPopImgData);
      /** @type {boolean} */
      this.canHit = false;
      this.setAnimType("once", "pop");
    }, self.prototype.burst = function () {
      /** @type {boolean} */
      this.removeMe = true;
    }, self;
  }(Utils.AnimSprite);
  exports.Dot = EventEmitter;
}(Elements || (Elements = {}));
var requestAnimFrame = function () {
  return window.requestAnimationFrame || (window.webkitRequestAnimationFrame || (window.mozRequestAnimationFrame || (window.oRequestAnimationFrame || (window.msRequestAnimationFrame || function (after) {
    window.setTimeout(after, 1E3 / 60, (new Date).getTime());
  }))));
}();
var previousTime;
/** @type {(HTMLElement|null)} */
var canvas = document.getElementById("canvas");
var ctx = canvas.getContext("2d");
canvas.width = 383, canvas.height = 550;
var canvasX;
var canvasY;
var canvasScaleX;
var canvasScaleY;
/** @type {(HTMLElement|null)} */
var div = document.getElementById("viewporter");
var sound;
var music;
/** @type {boolean} */
var allowSound = false;
/** @type {boolean} */
var muted = false;
var splash;
/** @type {number} */
var splashTimer = 0;
var screens;
var assetLib;
var preAssetLib;
/** @type {boolean} */
var rotatePause = false;
/** @type {boolean} */
var manualPause = false;
/** @type {boolean} */
var isMobile = false;
/** @type {string} */
var gameState = "loading";
/** @type {Array} */
var aLangs = new Array("EN");
/** @type {string} */
var curLang = "";
/** @type {boolean} */
var isBugBrowser = false;
/** @type {string} */
var deviceAgent = navigator.userAgent.toLowerCase();
if (deviceAgent.match(/(iphone|ipod|ipad)/) || (deviceAgent.match(/(android)/) || (deviceAgent.match(/(iemobile)/) || (deviceAgent.match(/iphone/i) || (deviceAgent.match(/ipad/i) || (deviceAgent.match(/ipod/i) || (deviceAgent.match(/blackberry/i) || deviceAgent.match(/bada/i)))))))) {
  /** @type {boolean} */
  isMobile = true;
  if (deviceAgent.match(/(android)/)) {
    if (!/Chrome/.test(navigator.userAgent)) {
      /** @type {boolean} */
      isBugBrowser = true;
    }
  }
}
var userInput = new Utils.UserInput(canvas, isBugBrowser);
resizeCanvas(), window.onresize = function () {
  setTimeout(function () {
    resizeCanvas();
  }, 1);
}, window.addEventListener("load", function () {
  setTimeout(function () {
    resizeCanvas();
  }, 0);
  window.addEventListener("orientationchange", function () {
    resizeCanvas();
  }, false);
}), ("undefined" != typeof window.AudioContext || ("undefined" != typeof window.webkitAudioContext || -1 == navigator.userAgent.indexOf("Android"))) && (allowSound = true, sound = new Howl({
  urls: ["audio/sound.ogg", "audio/sound.m4a"],
  sprite: {
    pop1: [0, 400],
    pop2: [500, 400],
    pop3: [1E3, 750],
    click: [2E3, 300],
    timesUp: [2500, 2400],
    explode: [5E3, 1500],
    drag: [7E3, 400]
  }
}), music = new Howl({
  urls: ["audio/music.ogg", "audio/music.m4a"],
  volume: 0.25,
  loop: true
}));
var panel;
var hud;
var background;
var gameScore;
/** @type {number} */
var gameNum = 0;
var aLevelUps;
/** @type {Array} */
var aTutorials = new Array({
  gameNum: 0,
  shown: false,
  panelType: "tutorial0"
}, {
  gameNum: 1,
  shown: false,
  panelType: "tutorial1"
}, {
  gameNum: 2,
  shown: false,
  panelType: "tutorial2"
}, {
  gameNum: 3,
  shown: false,
  panelType: "tutorial3"
}, {
  gameNum: 4,
  shown: false,
  panelType: "tutorial4"
});
var panelFrame;
var aDots;
var lastSelectedDot;
var aSelected;
/** @type {boolean} */
var blockTap = false;
var removedDots;
var gameTime;
var longestChain;
var balloonsPopped;
/** @type {number} */
var highScore = 0;
loadPreAssets();